# MQTT Topics Database Schema

# $SYS Metrics Table - stores broker statistics for MQTT $SYS topics
# Exported as MQTT topics so clients can subscribe to $SYS/broker/*
type mqtt_sys_metrics @table @export(name: "$SYS") {
  id: String @primaryKey
  topic: String @indexed
  value: String
  timestamp: String
}

# MQTT Topics Registry Table - central table for all MQTT topics
# Exported as root "/" to catch all non-$SYS MQTT topics
# Each row represents a topic with its latest message
# subscription_count tracks active subscriptions for cleanup
# @export with payloadProperty specifies which field contains the MQTT message payload
type mqtt_topics @table @export(name: "/", requireAuthentication: false, payloadProperty: "payload") {
  id: String @primaryKey
  topic: String @indexed
  payload: String
  qos: Int
  retain: Boolean
  timestamp: String
  client_id: String
  subscription_count: Int
}

# Note: Additional topic tables (mqtt_home, mqtt_sensors, etc.) can be created dynamically
# by the plugin when needed for topic-specific storage.
